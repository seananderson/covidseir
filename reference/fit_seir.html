<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fit a Stan SEIR model — fit_seir • covidseir</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fit a Stan SEIR model — fit_seir" />
<meta property="og:description" content="This function fits a Stan SEIR model to one or more sets of COVID-19 case
data. See project_seir() for making predictions/projections." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">covidseir</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/fitting-case-data.html">Fitting COVID-19 case data with covidseir</a>
    </li>
    <li>
      <a href="../articles/restarting.html">Fitting case data in multiple blocks</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit a Stan SEIR model</h1>
    
    <div class="hidden name"><code>fit_seir.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function fits a Stan SEIR model to one or more sets of COVID-19 case
data. See <code><a href='project_seir.html'>project_seir()</a></code> for making predictions/projections.</p>
    </div>

    <pre class="usage"><span class='fu'>fit_seir</span><span class='op'>(</span>
  <span class='va'>daily_cases</span>,
  obs_model <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"NB2"</span>, <span class='st'>"Poisson"</span><span class='op'>)</span>,
  forecast_days <span class='op'>=</span> <span class='fl'>0</span>,
  time_increment <span class='op'>=</span> <span class='fl'>0.25</span>,
  samp_frac_fixed <span class='op'>=</span> <span class='cn'>NULL</span>,
  samp_frac_type <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"fixed"</span>, <span class='st'>"estimated"</span>, <span class='st'>"rw"</span>, <span class='st'>"segmented"</span><span class='op'>)</span>,
  samp_frac_seg <span class='op'>=</span> <span class='cn'>NULL</span>,
  f_seg <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>daily_cases</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>forecast_days</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>,
  days_back <span class='op'>=</span> <span class='fl'>45</span>,
  R0_prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='fl'>2.6</span><span class='op'>)</span>, <span class='fl'>0.2</span><span class='op'>)</span>,
  phi_prior <span class='op'>=</span> <span class='fl'>1</span>,
  f_prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.4</span>, <span class='fl'>0.2</span><span class='op'>)</span>,
  e_prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.8</span>, <span class='fl'>0.05</span><span class='op'>)</span>,
  samp_frac_prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.4</span>, <span class='fl'>0.2</span><span class='op'>)</span>,
  start_decline_prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='fl'>15</span><span class='op'>)</span>, <span class='fl'>0.05</span><span class='op'>)</span>,
  end_decline_prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='fl'>22</span><span class='op'>)</span>, <span class='fl'>0.05</span><span class='op'>)</span>,
  use_ramp <span class='op'>=</span> <span class='cn'>TRUE</span>,
  rw_sigma <span class='op'>=</span> <span class='fl'>0.1</span>,
  seed <span class='op'>=</span> <span class='fl'>42</span>,
  chains <span class='op'>=</span> <span class='fl'>4</span>,
  iter <span class='op'>=</span> <span class='fl'>2000</span>,
  N_pop <span class='op'>=</span> <span class='fl'>5100000</span>,
  pars <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>D <span class='op'>=</span> <span class='fl'>5</span>, k1 <span class='op'>=</span> <span class='fl'>1</span><span class='op'>/</span><span class='fl'>5</span>, k2 <span class='op'>=</span> <span class='fl'>1</span>, q <span class='op'>=</span> <span class='fl'>0.05</span>, ud <span class='op'>=</span> <span class='fl'>0.1</span>, ur <span class='op'>=</span> <span class='fl'>0.02</span>, f0 <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>,
  i0_prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='fl'>8</span><span class='op'>)</span>, <span class='fl'>1</span><span class='op'>)</span>,
  state_0 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>E1_frac <span class='op'>=</span> <span class='fl'>0.4</span>, E2_frac <span class='op'>=</span> <span class='fl'>0.1</span>, I_frac <span class='op'>=</span> <span class='fl'>0.5</span>, Q_num <span class='op'>=</span> <span class='fl'>0</span>, R_num <span class='op'>=</span> <span class='fl'>0</span>,
    E1d_frac <span class='op'>=</span> <span class='fl'>0.4</span>, E2d_frac <span class='op'>=</span> <span class='fl'>0.1</span>, Id_frac <span class='op'>=</span> <span class='fl'>0.5</span>, Qd_num <span class='op'>=</span> <span class='fl'>0</span>, Rd_num <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>,
  save_state_predictions <span class='op'>=</span> <span class='cn'>FALSE</span>,
  delay_scale <span class='op'>=</span> <span class='fl'>9.85</span>,
  delay_shape <span class='op'>=</span> <span class='fl'>1.73</span>,
  ode_control <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1e-07</span>, <span class='fl'>1e-06</span>, <span class='fl'>1e+06</span><span class='op'>)</span>,
  fit_type <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"NUTS"</span>, <span class='st'>"VB"</span>, <span class='st'>"optimizing"</span><span class='op'>)</span>,
  init <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"prior_random"</span>, <span class='st'>"optimizing"</span><span class='op'>)</span>,
  init_list <span class='op'>=</span> <span class='cn'>NULL</span>,
  X <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>daily_cases</th>
      <td><p>Either a vector of daily new cases if fitting to a single
data type or a matrix of case data if fitting to multiple data types. Each
data type should be in its own column. Can have NA values (will be ignored
in likelihood). A vector will be turned into a one column matrix.</p></td>
    </tr>
    <tr>
      <th>obs_model</th>
      <td><p>Type of observation model.</p></td>
    </tr>
    <tr>
      <th>forecast_days</th>
      <td><p>Number of days into the future to forecast. The model
will run faster with fewer forecasted days. It is recommended to set this
to 0 here and use <code><a href='project_seir.html'>project_seir()</a></code> for projections.</p></td>
    </tr>
    <tr>
      <th>time_increment</th>
      <td><p>Time increment for ODEs and Weibull delay-model
integration in units of days. Larger numbers will run faster,
possibly at the expense of accuracy.</p></td>
    </tr>
    <tr>
      <th>samp_frac_fixed</th>
      <td><p>A vector (or matrix) of sampled fractions. Should be
of dimensions: <code>nrow(daily_cases) + forecast_days</code> (rows) by
<code>ncol(daily_cases</code> (columns). A vector will be turned into a one column
matrix.</p></td>
    </tr>
    <tr>
      <th>samp_frac_type</th>
      <td><p>How to treat the sample fraction. Fixed, estimated, a
constrained random walk, or segmented. Only applies to the first data type
column. The other data types must always have a fixed sample fraction
currently.</p></td>
    </tr>
    <tr>
      <th>samp_frac_seg</th>
      <td><p>A vector of sample fraction segment indexes of length
<code>daily_cases</code> + <code>forecast_days</code>. Should start at 1. Applies if
<code>samp_frac_type = "segmented"</code>.</p></td>
    </tr>
    <tr>
      <th>f_seg</th>
      <td><p>A vector of segment indexes of length <code>daily_cases</code> +
<code>forecast_days</code>. The segment index values should start at 0 to represent
the fixed "no social distancing" value <code>f0</code> from the <code>pars</code> argument.
Doesn't come into play until after <code>end_decline</code> day.</p></td>
    </tr>
    <tr>
      <th>days_back</th>
      <td><p>Number of days to go back for the Weibull case-delay
integration. Should be sufficiently large that the results do not change.</p></td>
    </tr>
    <tr>
      <th>R0_prior</th>
      <td><p>Lognormal log mean and SD for the R0 prior.</p></td>
    </tr>
    <tr>
      <th>phi_prior</th>
      <td><p>SD of <code>1/sqrt(phi) ~ Normal(0, SD)</code> prior, where NB2(mu,
phi) and <code>Var(Y) = mu + mu^2 / phi</code>. See the Stan
<a href='https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations'>Prior
Choice Recommendations</a>. If of length 2 will be treated as lognormal prior on phi.</p></td>
    </tr>
    <tr>
      <th>f_prior</th>
      <td><p>Beta mean and SD for the <code>f</code> parameters. If S segments are
used, should be a Sx2 matrix. If multiple <code>f</code> segments are used but
only one mean and SD are specified, they will be repeated as needed.</p></td>
    </tr>
    <tr>
      <th>e_prior</th>
      <td><p>Beta mean and SD for the <code>e</code> (derived) parameter.
<code>e</code> represents the fraction of people who are social distancing.</p></td>
    </tr>
    <tr>
      <th>samp_frac_prior</th>
      <td><p><code>samp_frac</code> prior if <code>samp_frac_type</code> is "estimated"
or "rw" or "segmented". In the case of the random walk, this specifies the
initial state prior. The two values correspond to the mean and SD of a Beta
distribution. Only applies to first time series.</p></td>
    </tr>
    <tr>
      <th>start_decline_prior</th>
      <td><p>Lognormal log mean and SD for the parameter
representing the day that social distancing starts ramping in
(<code>start_decline</code>).</p></td>
    </tr>
    <tr>
      <th>end_decline_prior</th>
      <td><p>Lognormal log mean and SD for the parameter
representing the day that the social distancing ramp finishes being ramped
in (<code>end_decline</code>).</p></td>
    </tr>
    <tr>
      <th>use_ramp</th>
      <td><p>Logical. Use the ramp?</p></td>
    </tr>
    <tr>
      <th>rw_sigma</th>
      <td><p>The fixed standard deviation on the optional <code>samp_frac</code>
random walk.</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>MCMC seed for <code><a href='https://mc-stan.org/rstan/reference/stan.html'>rstan::stan()</a></code>.</p></td>
    </tr>
    <tr>
      <th>chains</th>
      <td><p>Number of MCMC chains for <code><a href='https://mc-stan.org/rstan/reference/stan.html'>rstan::stan()</a></code>.</p></td>
    </tr>
    <tr>
      <th>iter</th>
      <td><p>MCMC iterations per chain for <code><a href='https://mc-stan.org/rstan/reference/stan.html'>rstan::stan()</a></code>.</p></td>
    </tr>
    <tr>
      <th>N_pop</th>
      <td><p>Number of people in population.</p></td>
    </tr>
    <tr>
      <th>pars</th>
      <td><p>A named numeric vector of fixed parameter values.</p></td>
    </tr>
    <tr>
      <th>i0_prior</th>
      <td><p>Infected people infected at initial point in time. Lognormal
log mean and SD for the parameter. Note that the default is set up for BC.
You may need to use a lower prior for other regions.</p></td>
    </tr>
    <tr>
      <th>state_0</th>
      <td><p>Initial state: a named numeric vector.</p></td>
    </tr>
    <tr>
      <th>save_state_predictions</th>
      <td><p>Include the state predictions? <code>y_hat</code> Will
make the resulting model object much larger.</p></td>
    </tr>
    <tr>
      <th>delay_scale</th>
      <td><p>Weibull scale parameter for the delay in reporting. If
there are multiple datatypes then this should be a vector of the same
length as the data types.</p></td>
    </tr>
    <tr>
      <th>delay_shape</th>
      <td><p>Weibull shape parameter for the delay in reporting. Same
format as for <code>delay_scale</code>.</p></td>
    </tr>
    <tr>
      <th>ode_control</th>
      <td><p>Control options for the Stan ODE solver. First is relative
difference, then absolute difference, and then maximum iterations. These
can likely be left as is.</p></td>
    </tr>
    <tr>
      <th>fit_type</th>
      <td><p>Stan sampling/fitting algorithm to use. NUTS =
<code><a href='https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html'>rstan::sampling()</a></code> or <code><a href='https://mc-stan.org/rstan/reference/stan.html'>rstan::stan()</a></code>; VB = <code><a href='https://mc-stan.org/rstan/reference/stanmodel-method-vb.html'>rstan::vb()</a></code>; optimizing =
<code><a href='https://mc-stan.org/rstan/reference/stanmodel-method-optimizing.html'>rstan::optimizing()</a></code>.</p></td>
    </tr>
    <tr>
      <th>init</th>
      <td><p>Initialization type. Draw randomly from the prior or try to use
the MAP estimate? Can be overridden by the <code>init_list</code> argument.</p></td>
    </tr>
    <tr>
      <th>init_list</th>
      <td><p>An optional named list foreign initialization. Note that the
<code>f_s</code> argument needs to be an array of appropriate length. See the example
below.</p></td>
    </tr>
    <tr>
      <th>X</th>
      <td><p>An optional model matrix applied additively to log expected cases.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other arguments to pass to <code><a href='https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html'>rstan::sampling()</a></code> / <code><a href='https://mc-stan.org/rstan/reference/stan.html'>rstan::stan()</a></code> /
<code><a href='https://mc-stan.org/rstan/reference/stanmodel-method-vb.html'>rstan::vb()</a></code> / <code><a href='https://mc-stan.org/rstan/reference/stanmodel-method-optimizing.html'>rstan::optimizing()</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A named list object</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Example daily case data:</span>
<span class='va'>cases</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
  <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>3</span>, <span class='fl'>1</span>, <span class='fl'>8</span>, <span class='fl'>0</span>, <span class='fl'>6</span>, <span class='fl'>5</span>, <span class='fl'>0</span>, <span class='fl'>7</span>, <span class='fl'>7</span>, <span class='fl'>18</span>, <span class='fl'>9</span>, <span class='fl'>22</span>, <span class='fl'>38</span>, <span class='fl'>53</span>, <span class='fl'>45</span>, <span class='fl'>40</span>,
  <span class='fl'>77</span>, <span class='fl'>76</span>, <span class='fl'>48</span>, <span class='fl'>67</span>, <span class='fl'>78</span>, <span class='fl'>42</span>, <span class='fl'>66</span>, <span class='fl'>67</span>, <span class='fl'>92</span>, <span class='fl'>16</span>, <span class='fl'>70</span>, <span class='fl'>43</span>, <span class='fl'>53</span>, <span class='fl'>55</span>, <span class='fl'>53</span>, <span class='fl'>29</span>,
  <span class='fl'>26</span>, <span class='fl'>37</span>, <span class='fl'>25</span>, <span class='fl'>45</span>, <span class='fl'>34</span>, <span class='fl'>40</span>, <span class='fl'>35</span>
<span class='op'>)</span>

<span class='co'># Example assumed sampling fractions of positive cases:</span>
<span class='va'>s1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0.1</span>, <span class='fl'>13</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0.2</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>cases</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>13</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># To use parallel processing with multiple chains:</span>
<span class='co'># options(mc.cores = parallel::detectCores() / 2)</span>

<span class='co'># Only using 200 iterations and MAP (optimizing) fitting for example speed:</span>
<span class='va'>m</span> <span class='op'>&lt;-</span> <span class='fu'>fit_seir</span><span class='op'>(</span>
  <span class='va'>cases</span>,
  iter <span class='op'>=</span> <span class='fl'>200</span>,
  fit_type <span class='op'>=</span> <span class='st'>"optimizing"</span>,
  samp_frac_fixed <span class='op'>=</span> <span class='va'>s1</span>
<span class='op'>)</span>
</div><div class='output co'>#&gt; Finding the MAP estimate.</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>m</span><span class='op'>)</span>
</div><div class='output co'>#&gt; MAP estimate:
#&gt;            i0            R0 start_decline   end_decline        f_s[1] 
#&gt;          4.05          3.38         14.69         21.39          0.18 
#&gt;        phi[1]             e 
#&gt;          6.66          0.82 
#&gt; Mean in constrained space of MVN samples:
#&gt;            i0            R0 start_decline   end_decline        f_s[1] 
#&gt;          4.73          3.40         14.77         21.38          0.19 
#&gt;        phi[1]             e 
#&gt;          7.31          0.83 
#&gt; SD in constrained space of MVN samples:
#&gt;            i0            R0 start_decline   end_decline        f_s[1] 
#&gt;          3.08          0.27          0.71          1.00          0.09 
#&gt;        phi[1]             e 
#&gt;          2.51          0.04 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>m</span><span class='op'>)</span>
</div><div class='output co'>#&gt;  [1] "fit"                  "post"                 "phi_prior"           
#&gt;  [4] "R0_prior"             "f_prior"              "obs_model"           
#&gt;  [7] "e_prior_trans"        "start_decline_prior"  "end_decline_prior"   
#&gt; [10] "samp_frac_fixed"      "state_0"              "daily_cases"         
#&gt; [13] "days"                 "time"                 "last_day_obs"        
#&gt; [16] "pars"                 "f2_prior_beta_shape1" "f2_prior_beta_shape2"
#&gt; [19] "stan_data"            "days_back"            "opt"                 
#&gt; [22] "fit_type"            </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>m</span><span class='op'>$</span><span class='va'>post</span><span class='op'>)</span> <span class='co'># from rstan::extract(m$fit)</span>
</div><div class='output co'>#&gt; [1] "i0"            "R0"            "start_decline" "end_decline"  
#&gt; [5] "phi"           "ur"            "e"             "f_s"          </div><div class='input'>
<span class='co'># Use tidybayes if you'd like:</span>
<span class='co'># post_tidy &lt;- tidybayes::spread_draws(m$fit, c(y_rep, mu)[day, data_type])</span>

<span class='co'># Add hospitalization data and estimate 2 sample-fraction blocks</span>
<span class='co'># for the reported cases:</span>
<span class='va'>samp_frac_seg</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>13</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>cases</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>13</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>s2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0.07</span>, <span class='fl'>42</span><span class='op'>)</span> <span class='co'># Assuming 7\% of positive individuals are hospitalized</span>
<span class='va'>hosp</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
  <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>11</span>, <span class='fl'>9</span>, <span class='fl'>4</span>,
  <span class='fl'>7</span>, <span class='fl'>19</span>, <span class='fl'>23</span>, <span class='fl'>13</span>, <span class='fl'>11</span>, <span class='fl'>3</span>, <span class='fl'>13</span>, <span class='fl'>21</span>, <span class='fl'>14</span>, <span class='fl'>17</span>, <span class='fl'>29</span>, <span class='fl'>21</span>, <span class='fl'>19</span>, <span class='fl'>19</span>, <span class='fl'>10</span>, <span class='fl'>6</span>,
  <span class='fl'>11</span>, <span class='fl'>8</span>, <span class='fl'>11</span>, <span class='fl'>8</span>, <span class='fl'>7</span>, <span class='fl'>6</span>
<span class='op'>)</span>

<span class='co'># Only using 200 iterations and MAP (optimizing) fitting for example speed:</span>
<span class='va'>m2</span> <span class='op'>&lt;-</span> <span class='fu'>fit_seir</span><span class='op'>(</span>
  daily_cases <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>cases</span>, <span class='va'>hosp</span><span class='op'>)</span>,
  iter <span class='op'>=</span> <span class='fl'>200</span>,
  samp_frac_type <span class='op'>=</span> <span class='st'>"segmented"</span>, <span class='co'># `samp_frac_type` affects the first data type only</span>
  samp_frac_seg <span class='op'>=</span> <span class='va'>samp_frac_seg</span>,
  samp_frac_fixed <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>s1</span>, <span class='va'>s2</span><span class='op'>)</span>, <span class='co'># s1 is ignored and could be anything</span>
  delay_scale <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>9.8</span>, <span class='fl'>11.2</span><span class='op'>)</span>,
  delay_shape <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1.7</span>, <span class='fl'>1.9</span><span class='op'>)</span>,
  fit_type <span class='op'>=</span> <span class='st'>"optimizing"</span>
<span class='op'>)</span>
</div><div class='output co'>#&gt; Finding the MAP estimate.</div><div class='output co'>#&gt; <span class='warning'>Warning: first element used of 'length.out' argument</span></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>m2</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='warning'>Warning: first element used of 'length.out' argument</span></div><div class='output co'>#&gt; MAP estimate:
#&gt;            i0            R0 start_decline   end_decline        f_s[1] 
#&gt;          0.71          3.85         14.91         21.59          0.15 
#&gt;        phi[1]             e 
#&gt;          6.12          0.83 
#&gt; Mean in constrained space of MVN samples:
#&gt;            i0            R0 start_decline   end_decline        f_s[1] 
#&gt;          0.89          3.85         14.88         21.54          0.17 
#&gt;        phi[1]             e 
#&gt;          6.61          0.82 
#&gt; SD in constrained space of MVN samples:
#&gt;            i0            R0 start_decline   end_decline        f_s[1] 
#&gt;          0.65          0.31          0.74          1.16          0.09 
#&gt;        phi[1]             e 
#&gt;          2.22          0.05 </div><div class='input'>
<span class='co'># Estimate a second f_s segment:</span>
<span class='va'>f_seg</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>14</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>20</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>cases</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>20</span> <span class='op'>-</span> <span class='fl'>14</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>f_prior</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.4</span>,<span class='fl'>0.6</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0.2</span>,<span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>, ncol<span class='op'>=</span><span class='fl'>2</span>, nrow<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span> <span class='co'># nrow corresponds to num f_s segments</span>

<span class='co'># Only using 200 iterations and MAP (optimizing) fitting for example speed:</span>
<span class='va'>m3</span> <span class='op'>&lt;-</span> <span class='fu'>fit_seir</span><span class='op'>(</span>
  <span class='va'>cases</span>,
  iter <span class='op'>=</span> <span class='fl'>200</span>,
  f_seg <span class='op'>=</span> <span class='va'>f_seg</span>,
  f_prior <span class='op'>=</span> <span class='va'>f_prior</span>,
  samp_frac_fixed <span class='op'>=</span> <span class='va'>s1</span>,
  fit_type <span class='op'>=</span> <span class='st'>"optimizing"</span>
<span class='op'>)</span>
</div><div class='output co'>#&gt; Finding the MAP estimate.</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>m3</span><span class='op'>)</span>
</div><div class='output co'>#&gt; MAP estimate:
#&gt;            i0            R0 start_decline   end_decline        f_s[1] 
#&gt;          3.96          3.40         14.69         21.39          0.17 
#&gt;        f_s[2]        phi[1]             e 
#&gt;          0.71          6.88          0.82 
#&gt; Mean in constrained space of MVN samples:
#&gt;            i0            R0 start_decline   end_decline        f_s[1] 
#&gt;          4.63          3.39         14.71         21.35          0.18 
#&gt;        f_s[2]        phi[1]             e 
#&gt;          0.66          7.27          0.82 
#&gt; SD in constrained space of MVN samples:
#&gt;            i0            R0 start_decline   end_decline        f_s[1] 
#&gt;          2.71          0.24          0.68          0.97          0.09 
#&gt;        f_s[2]        phi[1]             e 
#&gt;          0.21          2.64          0.05 </div><div class='input'>
<span class='co'># Choose initial values as a named list:</span>
<span class='va'>m</span> <span class='op'>&lt;-</span> <span class='fu'>fit_seir</span><span class='op'>(</span><span class='va'>cases</span>,
  fit_type <span class='op'>=</span> <span class='st'>"optimizing"</span>,
  samp_frac_fixed <span class='op'>=</span> <span class='va'>s1</span>,
  init_list <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    R0 <span class='op'>=</span> <span class='fl'>3</span>, f_s <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span><span class='op'>(</span><span class='fl'>0.2</span><span class='op'>)</span>, <span class='co'># note that `f_s` is an array of appropriate length</span>
    i0 <span class='op'>=</span> <span class='fl'>5</span>, ur <span class='op'>=</span> <span class='fl'>0.025</span>, start_decline <span class='op'>=</span> <span class='fl'>15</span>, end_decline <span class='op'>=</span> <span class='fl'>22</span><span class='op'>)</span>
<span class='op'>)</span>
</div><div class='output co'>#&gt; Finding the MAP estimate.</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Sean C. Anderson, Andrew M. Edwards, Madi Yerlanov, Nicola Mulberry, Jessica E. Stockdale, Rebeca C. Falcao, Sarafa A. Iyaniwura, Michael C. Otterstatter, Michael A. Irvine, Naveed Z. Janjua, Daniel Coombs, Caroline Colijn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


